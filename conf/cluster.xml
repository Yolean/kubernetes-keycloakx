<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright 2019 Red Hat, Inc. and/or its affiliates
  ~ and other contributors as indicated by the @author tags.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<infinispan
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="urn:infinispan:config:10.1 https://infinispan.org/schemas/infinispan-config-10.1.xsd"
    xmlns="urn:infinispan:config:10.1">

  <jgroups>
    <stack name="kubernetes-keycloakx">
      <TCP bind_port="7800" port_range="30" recv_buf_size="20000000" send_buf_size="640000"/>
      <MPING bind_addr="127.0.0.1" break_on_coord_rsp="true"
             mcast_addr="${jgroups.mping.mcast_addr:228.2.4.6}"
             mcast_port="${jgroups.mping.mcast_port:43366}"
             num_discovery_runs="3"
             ip_ttl="${jgroups.udp.ip_ttl:2}"/>
      <MERGE3 />
      <FD_SOCK />
      <FD_ALL timeout="3000" interval="1000" timeout_check_interval="1000" />
      <VERIFY_SUSPECT timeout="1000" />
      <pbcast.NAKACK2 use_mcast_xmit="false" xmit_interval="100" xmit_table_num_rows="50"
                      xmit_table_msgs_per_row="1024" xmit_table_max_compaction_time="30000" />
      <UNICAST3 xmit_interval="100" xmit_table_num_rows="50" xmit_table_msgs_per_row="1024"
                xmit_table_max_compaction_time="30000" />
      <pbcast.STABLE stability_delay="200" desired_avg_gossip="2000" max_bytes="1M" />
      <pbcast.GMS print_local_addr="false" join_timeout="${jgroups.join_timeout:2000}" />
      <UFC max_credits="4m" min_threshold="0.40" />
      <MFC max_credits="4m" min_threshold="0.40" />
      <FRAG3 />
    </stack>
  </jgroups>

  <cache-container name="keycloak">
    <transport lock-timeout="60000" stack="kubernetes-keycloakx"/>
    <local-cache name="realms">
      <memory>
        <object size="10000"/>
      </memory>
    </local-cache>
    <local-cache name="users">
      <memory>
        <object size="10000"/>
      </memory>
    </local-cache>
    <distributed-cache name="sessions" owners="1"/>
    <distributed-cache name="authenticationSessions" owners="1"/>
    <distributed-cache name="offlineSessions" owners="1"/>
    <distributed-cache name="clientSessions" owners="1"/>
    <distributed-cache name="offlineClientSessions" owners="1"/>
    <distributed-cache name="loginFailures" owners="1"/>
    <local-cache name="authorization">
      <memory>
        <object size="10000"/>
      </memory>
    </local-cache>
    <replicated-cache name="work"/>
    <local-cache name="keys">
      <expiration max-idle="3600000"/>
      <memory>
        <object size="1000"/>
      </memory>
    </local-cache>
    <distributed-cache name="actionTokens" owners="2">
      <expiration max-idle="-1" interval="300000"/>
      <memory>
        <object size="-1"/>
      </memory>
    </distributed-cache>
  </cache-container>

</infinispan>
